<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--<meta charset="UTF-8">-->
<!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--<title>Buy Now</title>-->
<!--<style>-->
<!--    body { font-family: Arial, sans-serif; margin: 0; }-->
<!--    .overlay {-->
<!--        position: fixed; top: 0; left: 0; width: 100%; height: 100%;-->
<!--        background: rgba(0,0,0,0.5); backdrop-filter: blur(2px);-->
<!--        display: flex; justify-content: center; align-items: center;-->
<!--        z-index: 999;-->
<!--    }-->
<!--    .modal {-->
<!--        background: white; width: 1000px; display: flex;-->
<!--        border-radius: 12px; overflow: hidden; position: relative;-->
<!--        animation: fadeIn 0.3s ease-in-out; box-shadow: 0 5px 20px rgba(0,0,0,0.3);-->
<!--        min-height: 550px;-->
<!--    }-->
<!--    @keyframes fadeIn { from {opacity: 0; transform: scale(0.95);} to {opacity: 1; transform: scale(1);} }-->
<!--    .close-btn {-->
<!--        position: absolute; top: 12px; right: 18px; font-size: 28px; cursor: pointer; color: #333;-->
<!--    }-->
<!--    .left { flex: 1; background: #f9f9f9; display: flex; justify-content: center; align-items: center; padding: 20px; }-->
<!--    .left img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }-->
<!--    .right { flex: 1.5; padding: 35px; display: flex; flex-direction: column; justify-content: space-between; }-->
<!--    h2 { margin: 0; font-size: 26px; color: #222; }-->
<!--    .sizes button {-->
<!--        margin: 5px; padding: 10px 16px; border: 1px solid #ccc;-->
<!--        background: white; cursor: pointer; border-radius: 6px;-->
<!--        font-size: 14px; transition: all 0.2s ease-in-out;-->
<!--    }-->
<!--    .sizes button.active { border-color: #6a0dad; color: white; background: #6a0dad; transform: scale(1.1); }-->
<!--    .quantity { display: flex; align-items: center; margin-top: 12px; gap: 10px; }-->
<!--    .quantity button {-->
<!--        background: #eee; border: none; padding: 8px 16px; font-size: 18px;-->
<!--        cursor: pointer; border-radius: 4px;-->
<!--    }-->
<!--    .quantity span { color: green; font-weight: bold; }-->
<!--    .price { margin-top: 12px; }-->
<!--    .price .old { text-decoration: line-through; color: #888; margin-right: 10px; font-size: 16px; }-->
<!--    .price .new { font-size: 22px; font-weight: bold; color: #6a0dad; }-->
<!--    .add-cart {-->
<!--        display: block;-->
<!--        text-align: center;-->
<!--        text-decoration: none;-->
<!--        background: #6a0dad; color: white; padding: 16px; font-size: 18px;-->
<!--        border-radius: 8px; cursor: pointer; margin-top: 20px;-->
<!--    }-->
<!--    .delivery-info {-->
<!--        margin-top: 15px; font-size: 15px; color: #444; background: #f4f4f4;-->
<!--        padding: 12px; border-radius: 6px;-->
<!--    }-->
<!--    .payment-methods { display: flex; gap: 15px; margin-top: 15px; }-->
<!--    .payment-methods div {-->
<!--        flex: 1; text-align: center; padding: 14px; border: 1px solid #ccc;-->
<!--        border-radius: 6px; font-weight: bold; background: #fafafa;-->
<!--        cursor: pointer; font-size: 16px; transition: all 0.2s ease-in-out;-->
<!--    }-->
<!--    .payment-methods div.active { border-color: #6a0dad; background: #6a0dad; color: white; transform: scale(1.1); }-->
<!--    .installment-info {-->
<!--        margin-top: 15px; font-size: 15px; color: #333; background: #fff3cd;-->
<!--        padding: 12px; border-radius: 6px;-->
<!--    }-->
<!--    .no-size { font-style: italic; color: red; }-->
<!--</style>-->
<!--</head>-->
<!--<body>-->

<!--<div class="overlay">-->
<!--    <div class="modal">-->
<!--        <span class="close-btn" onclick="closeModal()">&times;</span>-->

<!--        <div class="left">-->
<!--            <img src="{{ products.image.url }}" alt="{{ products.name }}">-->
<!--        </div>-->

<!--        <div class="right">-->
<!--            <div>-->
<!--                <h2>{{ products.name }}</h2>-->
<!--                <p>Select Size:  {{ products.size }}</p>-->
<!--                <div class="sizes" id="sizes-container"></div>-->

<!--                <div class="quantity">-->
<!--                    <button onclick="decreaseQty()">-</button>-->
<!--                    <input type="text" id="qty" value="1" readonly style="width:45px; text-align:center; border:none; font-size:16px;">-->
<!--                    <button onclick="increaseQty()">+</button>-->
<!--                    <span>Stock: <span id="stock">{{ stock }}</span></span>-->
<!--                </div>-->

<!--                <div class="price">-->
<!--                    {% if products.discount %}-->
<!--                        <span class="old"> $ {{ products.discount }}</span>-->
<!--                    {% endif %}-->
<!--                    <span class="new" id="product-price">${{ products.price }}</span>-->
<!--                </div>-->

<!--                <div class="delivery-info">ðŸšš Delivery in 1 day â€¢ Guaranteed quality</div>-->

<!--                <div class="payment-methods">-->
<!--                    <div onclick="selectPayment(this, 'cash')">ðŸ’µ Cash</div>-->
<!--                    <div onclick="selectPayment(this, 'card')">ðŸ’³ Card</div>-->
<!--                </div>-->

<!--                <div class="installment-info">-->
<!--                    ðŸ’¡ Pay in installments from $10/month â€” Flexible payment options available.-->
<!--                </div>-->

<!--                &lt;!&ndash; Add to Cart tugmasi &ndash;&gt;-->
<!--                <a href="/cart-page-link/" class="add-cart">Order Now</a>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<script>-->
<!--    let stock = {{ stock }};-->
<!--    let qtyInput = document.getElementById('qty');-->
<!--    let priceElement = document.getElementById('product-price');-->

<!--    // faqat raqamni olamiz-->
<!--    let originalPrice = parseFloat(priceElement.innerText.replace('$',''));-->

<!--    function increaseQty() {-->
<!--        let current = parseInt(qtyInput.value);-->
<!--        if (current < stock) {-->
<!--            current += 1;-->
<!--            qtyInput.value = current;-->
<!--            priceElement.innerText = '$' + (originalPrice * current);-->
<!--        }-->
<!--    }-->

<!--    function decreaseQty() {-->
<!--        let current = parseInt(qtyInput.value);-->
<!--        if (current > 1) {-->
<!--            current -= 1;-->
<!--            qtyInput.value = current;-->
<!--            priceElement.innerText = '$' + (originalPrice * current);-->
<!--        }-->
<!--    }-->

<!--    function selectPayment(el) {-->
<!--        document.querySelectorAll('.payment-methods div').forEach(div => div.classList.remove('active'));-->
<!--        el.classList.add('active');-->
<!--    }-->

<!--    function closeModal() {-->
<!--        document.querySelector(".overlay").style.display = "none";-->
<!--    }-->

<!--    // Dynamic sizes (agar backenddan olingan bo'lsa)-->
<!--    function loadSizes() {-->
<!--        let container = document.getElementById('sizes-container');-->
<!--        container.innerHTML = "";-->
<!--        if (typeof availableSizes !== 'undefined' && availableSizes.length > 0) {-->
<!--            availableSizes.forEach((size, index) => {-->
<!--                let btn = document.createElement('button');-->
<!--                btn.textContent = size;-->
<!--                if (index === 0) btn.classList.add('active');-->
<!--                btn.onclick = function() {-->
<!--                    document.querySelectorAll('.sizes button').forEach(b => b.classList.remove('active'));-->
<!--                    btn.classList.add('active');-->
<!--                };-->
<!--                container.appendChild(btn);-->
<!--            });-->
<!--        } else {-->
<!--            container.innerHTML = "<p class='no-size'>No size</p>";-->
<!--        }-->
<!--    }-->

<!--    loadSizes();-->
<!--</script>-->

<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buy Now</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; }
    .overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); backdrop-filter: blur(2px);
        display: flex; justify-content: center; align-items: center;
        z-index: 999;
    }
    .modal {
        background: white; width: 1000px; display: flex;
        border-radius: 12px; overflow: hidden; position: relative;
        animation: fadeIn 0.3s ease-in-out; box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        min-height: 550px;
    }
    @keyframes fadeIn { from {opacity: 0; transform: scale(0.95);} to {opacity: 1; transform: scale(1);} }
    .close-btn {
        position: absolute; top: 12px; right: 18px; font-size: 28px; cursor: pointer; color: #333;
    }
    .left { flex: 1; background: #f9f9f9; display: flex; justify-content: center; align-items: center; padding: 20px; }
    .left img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
    .right { flex: 1.5; padding: 35px; display: flex; flex-direction: column; justify-content: space-between; }
    h2 { margin: 0; font-size: 26px; color: #222; }
    .sizes button {
        margin: 5px; padding: 10px 16px; border: 1px solid #ccc;
        background: white; cursor: pointer; border-radius: 6px;
        font-size: 14px; transition: all 0.2s ease-in-out;
    }
    .sizes button.active { border-color: #6a0dad; color: white; background: #6a0dad; transform: scale(1.1); }
    .quantity { display: flex; align-items: center; margin-top: 12px; gap: 10px; }
    .quantity button {
        background: #eee; border: none; padding: 8px 16px; font-size: 18px;
        cursor: pointer; border-radius: 4px;
    }
    .quantity span { color: green; font-weight: bold; }
    .price { margin-top: 12px; }
    .price .old { text-decoration: line-through; color: #888; margin-right: 10px; font-size: 16px; }
    .price .new { font-size: 22px; font-weight: bold; color: #6a0dad; }
    .add-cart {
        display: block;
        text-align: center;
        text-decoration: none;
        background: #6a0dad; color: white; padding: 16px; font-size: 18px;
        border-radius: 8px; cursor: pointer; margin-top: 20px;
    }
    .delivery-info {
        margin-top: 15px; font-size: 15px; color: #444; background: #f4f4f4;
        padding: 12px; border-radius: 6px;
    }
    .payment-methods { display: flex; gap: 15px; margin-top: 15px; }
    .payment-methods div {
        flex: 1; text-align: center; padding: 14px; border: 1px solid #ccc;
        border-radius: 6px; font-weight: bold; background: #fafafa;
        cursor: pointer; font-size: 16px; transition: all 0.2s ease-in-out;
    }
    .payment-methods div.active { border-color: #6a0dad; background: #6a0dad; color: white; transform: scale(1.1); }
    .installment-info {
        margin-top: 15px; font-size: 15px; color: #333; background: #fff3cd;
        padding: 12px; border-radius: 6px;
    }
    .no-size { font-style: italic; color: red; }
    .form-group { margin-top: 10px; }
    .form-group label { font-weight: bold; display: block; margin-bottom: 5px; }
    .form-group input, .form-group select {
        width: 100%; padding: 10px; border: 1px solid #ccc;
        border-radius: 6px; font-size: 14px;
    }
</style>
</head>
<body>

<div class="overlay">
    <div class="modal">
        <span class="close-btn" onclick="closeModal()">&times;</span>

        <div class="left">
            <img src="{{ products.image.url }}" alt="{{ products.name }}">
        </div>

        <div class="right">
            <form method="POST"  >  <!--  -->
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ products.name }}">

                <h2>{{ products.name }}</h2>
                <p>Select Size: {{ products.size }}</p>
                <div class="sizes" id="sizes-container"></div>

                <div class="quantity">
                    <button type="button" onclick="decreaseQty()">-</button>
                    <input type="text" id="qty" name="buying_count" value="1" readonly style="width:45px; text-align:center; border:none; font-size:16px;">
                    <button type="button" onclick="increaseQty()">+</button>
                    <span>Stock: <span id="stock">{{ stock }}</span></span>
                </div>

                <div class="price">
                    {% if products.discount %}
                        <span class="old">${{ products.discount }}</span>
                    {% endif %}
                    <span class="new" id="product-price">${{ products.price }}</span>
                </div>

                <div class="delivery-info">ðŸšš Delivery in 1 day â€¢ Guaranteed quality</div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" name="phone_number" placeholder="+998..." required>
                </div>

                <div class="form-group">
                    <label>Region</label>
                    <select name="region" id="region" required>
                        <option value="">Select region</option>
                        <option value="Tashkent">Tashkent</option>
                        <option value="Samarkand">Samarkand</option>
                        <option value="Bukhara">Bukhara</option>
                        <option value="Fergana">Fergana</option>
                        <option value="Andijan">Andijan</option>
                        <option value="Namangan">Namangan</option>
                        <option value="Kashkadarya">Kashkadarya</option>
                        <option value="Surkhandarya">Surkhandarya</option>
                        <option value="Jizzakh">Jizzakh</option>
                        <option value="Sirdarya">Sirdarya</option>
                        <option value="Navoi">Navoi</option>
                        <option value="Karakalpakstan">Karakalpakstan</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>City/District</label>
                    <select name="city" id="city" required>
                        <option value="">Select city</option>
                    </select>
                </div>

                 <div class="form-group">
                    <label>Name</label>
                    <input type="text" name="name" placeholder="Enter your name" required>
                </div>

                <div class="payment-methods">
                    <div onclick="selectPayment(this, 'cash')">ðŸ’µ Cash</div>
                    <div onclick="selectPayment(this, 'card')">ðŸ’³ Card</div>
                </div>
                <input type="hidden" name="payment_type" id="payment_type">

                <div class="installment-info">
                    ðŸ’¡ Pay in installments from $10/month â€” Flexible payment options available.
                </div>

                <button type="submit" class="add-cart">Order Now</button>
            </form>
        </div>
    </div>
</div>

<script>
    let stock = {{ stock }};
    let qtyInput = document.getElementById('qty');
    let priceElement = document.getElementById('product-price');
    let originalPrice = parseFloat(priceElement.innerText.replace('$',''));

    function increaseQty() {
        let current = parseInt(qtyInput.value);
        if (current < stock) {
            current += 1;
            qtyInput.value = current;
            priceElement.innerText = '$' + (originalPrice * current);
        }
    }

    function decreaseQty() {
        let current = parseInt(qtyInput.value);
        if (current > 1) {
            current -= 1;
            qtyInput.value = current;
            priceElement.innerText = '$' + (originalPrice * current);
        }
    }

    function selectPayment(el, type) {
        document.querySelectorAll('.payment-methods div').forEach(div => div.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('payment_type').value = type;
    }

    function closeModal() {
        document.querySelector(".overlay").style.display = "none";
    }

    function loadSizes() {
        let container = document.getElementById('sizes-container');
        container.innerHTML = "";
        if (typeof availableSizes !== 'undefined' && availableSizes.length > 0) {
            availableSizes.forEach((size, index) => {
                let btn = document.createElement('button');
                btn.textContent = size;
                if (index === 0) btn.classList.add('active');
                btn.onclick = function() {
                    document.querySelectorAll('.sizes button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                };
                container.appendChild(btn);
            });
        } else {
            container.innerHTML = "<p class='no-size'>No size</p>";
        }
    }

    const citiesByRegion = {
        "Tashkent": ["Chilonzor", "Yunusabad", "Sergeli", "Bektemir"],
        "Samarkand": ["Samarkand city", "Urgut", "Kattakurgan"],
        "Bukhara": ["Bukhara city", "Gijduvan", "Kogon"],
        "Fergana": ["Fergana city", "Kokand", "Margilan"],
        "Andijan": ["Andijan city", "Asaka", "Shahrixon"],
        "Namangan": ["Namangan city", "Chortoq", "Uchqo'rg'on"],
        "Kashkadarya": ["Qarshi", "Shahrisabz", "Kitob"],
        "Surkhandarya": ["Termiz", "Denov", "Sherobod"],
        "Jizzakh": ["Jizzakh city", "G'allaorol", "Zafarobod"],
        "Sirdarya": ["Guliston", "Shirin", "Yangiyer"],
        "Navoi": ["Navoi city", "Zarafshon", "Kanimex"],
        "Karakalpakstan": ["Nukus", "Mo'ynoq", "Taxiatosh"]
    };

    document.getElementById("region").addEventListener("change", function() {
        let cities = citiesByRegion[this.value] || [];
        let citySelect = document.getElementById("city");
        citySelect.innerHTML = "<option value=''>Select city</option>";
        cities.forEach(city => {
            let opt = document.createElement("option");
            opt.value = city;
            opt.textContent = city;
            citySelect.appendChild(opt);
        });
    });

    loadSizes();
</script>

</body>
</html>
